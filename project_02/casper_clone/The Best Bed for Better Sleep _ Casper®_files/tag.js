(function(f){try{if(!window[f.ns]){if(!window.am){am={c:{}};var k=am.c[f.id]={};k.d=[];k.d.push("lazy:"+Date.now())}f.ns="am"}var a=window[f.ns].c[f.id];a?(a.v=a.v||{},a.v.version="1.6.0.0",a.v.debugLevel=f.debug?f.debug:0,a.v.auditLevel=f.audit?f.audit:0,a.v.tto=f.tto?f.tto:0,a.v.sessionId=Math.random().toString().slice(2,10),a.v.href=location.href,a.v.ref=document.referrer,a.v.tagsFired=[],a.v.context="",a.v.cid=f.id,a.v.auditTag="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+a.v.cid,am.c.cb={tto:function(b){b=parseInt(b.uid)||0;var a=Object.keys(am.c)[0],e="ats-cid-"+a+"-sid",f=Math.random().toString().slice(2,10);if(0===b)for(am.c[a].f.setCookie(e,f+"s",!1,"/",!1,!0,"Strict"),b=0;b<document.links.length;b+=1){if(a=document.links[b],"http"===a.href.substr(0,4)||"//"===a.href.substr(0,2))a.href="//ib.adnxs.com/getuid?"+encodeURIComponent(a.href)}else am.c[a].f.setCookie(e,f+"x",!1,"/",!1,!0,"Strict")}},a.f={logit:function(b){a.d.push(b+":"+new Date);0<a.v.debugLevel&&console.log(a.v.cid+"-DEBUG:"+b)},safeEval:function(b,c){var e="";try{a.v.context=c,"undefined"!==typeof c&&null!==c&&(b="var el=am.c['"+a.v.cid+"'].v.context;"+b),e=eval(b)}catch(m){}return e},getCookie:function(a){var b=document.cookie.indexOf(a+"="),e=b+a.length+1;if(!b&&a!==document.cookie.substring(0,a.length)||-1===b)return null;a=document.cookie.indexOf(";",e);-1===a&&(a=document.cookie.length);return unescape(document.cookie.substring(e,a))},setCookie:function(a,c,e,f,g,h,l){var b=new Date;b.setTime(b.getTime());e&&(e*=864E5);b=new Date(b.getTime()+e);document.cookie=a+"="+escape(c)+(e?";Expires="+b.toGMTString():"")+(f?";Path="+f:"")+(g?";Domain="+g:"")+(l?";SameSite="+l:"")+(h?";Secure":"")},getSessionId:function(){var b="ats-cid-"+a.v.cid+"-sid",c=a.f.getCookie(b);c||(c=Math.random().toString().slice(2,10),a.f.setCookie(b,c,!1,"/",!1,!0,"Strict"));return c},getParentReferrer:function(b){if(b.parent===b)try{var c=b.document.referrer}catch(e){c="(iframed)"+document.referrer}else c=b.parent?a.f.getParentReferrer(b.parent):window.document.referrer;return c},getParentHref:function(b){if(b.parent===b)try{var c=b.location.href}catch(e){c="(iframed)"+location.href}else c=b.parent?a.f.getParentHref(b.parent):window.location.href;return c},evalTrigger:function(b,c){return b.trigger.result=a.f.safeEval(b.trigger.code,c)},evalVars:function(b,c,e){b.result=a.f.safeEval(b.value,e);return c.text.replace(new RegExp(b.name,"g"),b.result)},fireTag:function(b){function c(a){(new Image).src=a.text}function e(b){var c=document.getElementsByTagName("script")[0],e=document.createElement("script");e.async=!0;e.id=a.v.cid+"-tid-"+b.id;e.src=b.text;c.parentNode.insertBefore(e,c)}function f(){var c=document.createElement("div");c.style="width:0px;height:0px;display:none;visibility:hidden";c.id=a.v.cid+"-tid-"+b.id;c.innerHTML=b.text;document.body.appendChild(c)}function g(b){var c=document.createElement("iframe");c.id=a.v.cid+"-tid-"+b.id;c.style="width:0px;height:0px;display:none;visibility:hidden";c.width=0;c.height=0;c.src=b.text;document.body.appendChild(c)}function h(b){var c=document.createElement("iframe");c.id=a.v.cid+"-tid-"+b.id;c.style="width:0px;height:0px;display:none;visibility:hidden";c.width=0;c.height=0;document.body.appendChild(c);c.contentWindow.document.open().write("<html><body>"+b.text+"</body></html>");c.contentWindow.document.close()}switch(b.obj){case "img":c(b);break;case "script":e(b);break;case "div":f(b);break;case "null":break;case "iframe":g(b);break;default:h(b)}},firePreAudit:function(){a.f.fireTag({id:-1,name:"pre-audit",trigger:{name:"always",code:"true"},vars:[],obj:"img",text:a.v.auditTag})},firePostAudit:function(){a.f.fireTag({id:1,name:"post-audit",trigger:{name:"audit",code:"true"},vars:[],obj:"img",text:a.v.auditTag+"&px="+a.v.tagsFired.join()})},fireDefaultTag:function(b){var c;if(a.f.evalTrigger(b)){for(c=0;c<b.vars.length;c+=1){var e=b.vars[c];b.text=a.f.evalVars(e,b)}a.v.tagsFired.push(b.id);a.f.fireTag(b)}},prepareDelayTag:function(b,c){setTimeout(function(){a.f.fireDefaultTag(b)},1E3*c)},prepareEventTag:function(b){window.addEventListener(b.trigger.event,function(c){try{var e;if(a.f.evalTrigger(b,c.target)){for(e=0;e<b.vars.length;e+=1){var f=b.vars[e];b.text=a.f.evalVars(f,b,c.target)}a.v.tagsFired.push(b.id);a.f.fireTag(b)}}catch(g){console.log(a.v.cid+"-ERR: trapped event error: "+g.message),document.createElement("img").src="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+a.v.cid+"&err=event&msg="+escape(g.message)}},!1)},registerEventListener:function(){document.body.addEventListener("am.custom",function(b){a.d.push("am.custom:"+JSON.stringify(b.detail));a.f.fireTag({id:"am.custom",name:"am.custom",text:a.v.auditTag+"&vars="+escape(encodeURIComponent(JSON.stringify(b.detail.message))),obj:"img"})})},main:function(b){var c;a.v.sessionId=a.f.getSessionId();a.v.href=a.f.getParentHref(window);a.v.ref=a.f.getParentReferrer(window);a.v.debugLevel=/amdebug=1/i.test(a.v.href)?1:a.v.debugLevel;a.v.auditTag=a.v.auditTag+"&sid="+a.v.sessionId+"&url="+escape(a.v.ref);a.v.atsCookie=a.f.getCookie("ats-cid-"+a.v.cid+"-sid");1<a.v.auditLevel&&a.f.firePreAudit();a.f.registerEventListener();for(c=0;c<b.length;c+=1){var e=b[c];e.trigger.event&&""!==e.trigger.event?a.f.prepareEventTag(e):(d="undefined"===typeof e.trigger.delay?0:e.trigger.delay,a.f.prepareDelayTag(e,d))}a.v.atsCookie&&9>a.v.atsCookie.length&&a.v.tto&&setTimeout(function(){var a=Object.keys(am.c)[0];am.c[a].f.fireTag({id:"321",name:"3to1",obj:"script",text:"//ib.adnxs.com/getuidp?callback=am.c.cb.tto",trigger:{name:"321all",code:"true"},vars:[]})},Math.random().toString().slice(2,6));0<a.v.auditLevel&&a.f.firePostAudit();a.d.push("finish:"+Date.now())}},a.t=[{"id":0,"obj":"img","name":"audit","text":"{auditUrl}&vars=productsArr:{productsArr},pathname:{pathname}","vars":[{"name":"{auditUrl}","value":"am.c['AM-141140'].v.auditTag"},{"name":"{productsArr}","value":"window.CasperProducts?JSON.stringify(CasperProducts):''"},{"name":"{pathname}","value":"location.pathname?'\"'+location.pathname.toString()+'\"':''"}],"trigger":{"code":"true","name":"all","event":""}},{"id":"728228","obj":"img","name":"AddToCartClick","text":"https://secure.adnxs.com/px?id=728228&seg=3838354&t=2","vars":[],"trigger":{"code":"((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/mattresses\\/casper-essential\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/mattresses\\/casper\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/mattresses\\/casper-wave\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/pillows\\//i.test(location.href))) || ((el.className && el.className === 'SheetSetPurchaser__add-to-cart___2HE9O purchaser__add-to-cart___1g5HS buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv') && (/casper.com\\/sheets\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/duvet-inserts\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/adjustable-bed-frames\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/mattress-foundation\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/metal-bed-frame\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/mattress-protector\\//i.test(location.href))) || ((el.className && el.className === 'DogBedPurchaser__add-to-cart___3YYaY buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv') && (/casper.com\\/dog-beds\\//i.test(location.href))) || ((el.className && el.className === 'BuyBar__add-to-cart--single___ZZnsM BuyBar__add-to-cart___1BStt buttons__button--primary___2n-R3 buttons__button___1sONg fonts__calibre-medium___2Umlv BuyBar__button-width___2LmY2') && (/casper.com\\/woolly-magazine\\//i.test(location.href)))","name":"AddToCartClick","event":"click"}},{"id":"984478","obj":"img","name":"MattressesPage","text":"https://secure.adnxs.com/px?id=984478&seg=12292259&t=2","vars":[],"trigger":{"code":"/mattresses/i.test(location.href)","name":"MattressesPage","event":""}},{"id":"767520","obj":"img","name":"AllPages","text":"https://secure.adnxs.com/px?id=767520&seg=11370173&t=2","vars":[],"trigger":{"code":"/casper.com/i.test(location.href)","name":"AllPages","event":""}},{"id":"1035653","obj":"img","name":"WavePurchase","text":"https://secure.adnxs.com/px?id=1035653&seg=14729630&t=2","vars":[],"trigger":{"code":"/orders\\/thank-you\\/R/.test(location.href) && window.CasperProducts && /SKU/i.test(JSON.stringify(window.CasperProducts)) && /WAVEMAT/i.test(JSON.stringify(window.CasperProducts))","name":"WavePurchase","event":""}}],a.f.main(a.t)):(console.log(f.id+"-ERR: namespace _NOT_ found"),document.createElement("img").src="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+f.id+"&err=no-namespace")}catch(b){console.log(f.id+"-ERR: trapped error: "+b.message),document.createElement("img").src="//ib.adnxs.com/getuid?//segment.a3cloud.net/px.png?uid=$UID&cid="+f.id+"&err=unknown&msg="+escape(b.message)}})({ns:"am",id:"AM-141140",audit:0,debug:0,tto:0});